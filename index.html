<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sevens to Betsy</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1b1b1b">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker Registered'))
        .catch(err => console.error('Service Worker Registration Failed:', err));
    }
  </script>
  <style>
    body {
      background: #1b1b1b;
      color: #f5f5dc;
      font-family: 'Courier New', Courier, monospace;
      text-align: center;
      padding: 20px;
    }
    .logo {
      max-width: 300px;
      margin-bottom: 10px;
    }
    .chalkboard {
      border: 8px solid #444;
      padding: 20px;
      background: #2b2b2b;
      border-radius: 10px;
      box-shadow: inset 0 0 20px #000;
    }
    .player {
      margin: 15px 0;
    }
    .score-visual {
      font-size: 1.5em;
      margin-top: 5px;
    }
    .books {
      font-size: 1.2em;
      margin-top: 5px;
    }
    .podium {
      margin-top: 30px;
      font-size: 1.2em;
    }
    input[type="number"] {
      width: 60px;
    }
    input[type="text"] {
      width: 120px;
    }
    button {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 1em;
    }
    #endRoundBtn {
      margin-top: 20px;
      font-weight: bold;
      background: #444;
      border: 2px solid #888;
    }
  </style>
</head>
<body>
  <img src="72Blogo.png" alt="Sevens to Betsy Logo" class="logo">
  <div>
    <label>Players: <input id="numPlayers" type="number" min="2" max="4" value="2"></label>
    <label>Max Score:
      <select id="maxScore">
        <option value="150">150</option>
        <option value="200">200</option>
        <option value="250">250</option>
      </select>
    </label>
    <button onclick="startGame()">Start Game</button>
  </div>
  <div class="chalkboard" id="gameBoard"></div>
  <script>
    let players = [];
    let history = [];
    let maxScore = 150;

    function startGame() {
      const count = parseInt(document.getElementById('numPlayers').value);
      maxScore = parseInt(document.getElementById('maxScore').value);
      players = [];
      history = [];
      const board = document.getElementById('gameBoard');
      board.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const name = prompt(`Enter name for Player ${i + 1}:`, `Player ${i + 1}`);
        players.push({ name, score: 0, visual: '' });
      }
      render();
    }

    function render() {
      const board = document.getElementById('gameBoard');
      board.innerHTML = '';
      players.forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'player';
        const books = Math.floor(p.score / 50);
        div.innerHTML = `
          <strong>${p.name}</strong> (${p.score})<br>
          <div class="score-visual">${p.visual}</div>
          <div class="books">Books: ${'üìò'.repeat(books)}</div>
          <input id="score-${i}" type="number" step="5" min="5" max="50">
          <button onclick="addScore(${i})">Add</button>
        `;
        board.appendChild(div);
      });
      const undoBtn = document.createElement('button');
      undoBtn.textContent = 'Undo Last Score';
      undoBtn.onclick = undoLast;
      board.appendChild(undoBtn);

      if (players.some(p => p.score >= maxScore)) {
        const endBtn = document.createElement('button');
        endBtn.id = 'endRoundBtn';
        endBtn.textContent = 'End Game?';
        endBtn.onclick = confirmEndGame;
        board.appendChild(endBtn);
      }
    }

    function addScore(index) {
      const input = document.getElementById(`score-${index}`);
      const value = parseInt(input.value);
      if (!value || value % 5 !== 0) return alert('Score must be in multiples of 5.');

      history.push({ index, value });
      players[index].score += value;
      players[index].visual += getScoreVisual(value);
      input.value = '';

      render();
    }

    function getScoreVisual(score) {
      let visual = '';
      let remaining = score;
      while (remaining >= 10) {
        visual += 'X';
        remaining -= 10;
      }
      while (remaining >= 5) {
        visual += '/';
        remaining -= 5;
      }
      return visual.match(/.{1,5}/g)?.join(', ') || visual;
    }

    function undoLast() {
      const last = history.pop();
      if (!last) return;
      players[last.index].score -= last.value;
      players[last.index].visual = players[last.index].visual.slice(0, -getScoreVisual(last.value).length - (players[last.index].visual.endsWith(', ') ? 2 : 0));
      render();
    }

    function confirmEndGame() {
      if (confirm('Are you ready to end the game?')) {
        showPodium();
      }
    }

    function showPodium() {
      players.sort((a, b) => b.score - a.score);
      const board = document.getElementById('gameBoard');
      board.innerHTML = '<h2>üèÜ Final Standings üèÜ</h2>';
      players.forEach((p, i) => {
        const place = ['ü•á', 'ü•à', 'ü•â', 'üéñÔ∏è'][i] || 'üéñÔ∏è';
        const div = document.createElement('div');
        div.className = 'podium';
        div.textContent = `${place} ${p.name} - ${p.score} points`;
        board.appendChild(div);
      });

      const restartText = document.createElement('p');
      restartText.textContent = 'Start a new game?';
      restartText.style.marginTop = '30px';
      board.appendChild(restartText);

      const samePlayersBtn = document.createElement('button');
      samePlayersBtn.textContent = 'Same Players';
      samePlayersBtn.onclick = () => {
        players.forEach(p => { p.score = 0; p.visual = ''; });
        history = [];
        render();
      };
      board.appendChild(samePlayersBtn);

      const newPlayersBtn = document.createElement('button');
      newPlayersBtn.textContent = 'New Players';
      newPlayersBtn.onclick = startGame;
      board.appendChild(newPlayersBtn);
    }
      });
    }
  </script>
</body>
</html>
